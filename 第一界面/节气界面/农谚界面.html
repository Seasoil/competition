<!DOCTYPE html>
<html lang="zh-CN" style="height: 100%">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†œè°šåˆ†ç±»ç³»ç»Ÿ-é«˜çº§ç‰ˆ</title>
    <script src="./js/echarts.min.js"></script>
    <style>
        /* åŸºç¡€é‡ç½®ä¸èƒŒæ™¯ç³»ç»Ÿ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background:
                linear-gradient(rgba(46, 39, 51, 0.95),
                    rgba(46, 39, 51, 0.95)),
                url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            padding-top: 80px;
        }

        /* ç»ç’ƒæ‹Ÿæ€å¯¼èˆªæ  */
        .main-nav {
            background: rgba(58, 50, 65, 0.85);
            backdrop-filter: blur(12px);
            padding: 14px 5%;
            display: flex;
            gap: 20px;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
        }

        /* åŠ¨æ€æ¸å˜æŒ‰é’® */
        .nav-btn {
            background: linear-gradient(135deg, #6DA65D 0%, #8BC34A 100%);
            border: none;
            color: #E0DCE5;
            padding: 14px 32px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            letter-spacing: 0.8px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 24px rgba(109, 166, 93, 0.35);
        }

        /* æŒ‰é’®æµå…‰æ•ˆæœ */
        @keyframes gradientGlow {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg,
                    rgba(109, 166, 93, 0.4),
                    rgba(139, 195, 74, 0.2),
                    rgba(109, 166, 93, 0.4));
            z-index: -1;
            border-radius: 12px;
            animation: gradientGlow 4s ease infinite;
            background-size: 400% 400%;
        }

        .container {
            display: flex;
            gap: 24px;
            padding: 24px 5%;
            min-height: calc(100vh - 80px);
        }

        /* å›¾è¡¨å®¹å™¨ */
        #chart-container {
            flex: 1;
            background: rgba(58, 50, 65, 0.8);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
            min-height: 600px;
        }

        /* å³ä¾§é¢æ¿ */
        .right-panel {
            width: 420px;
            background: rgba(74, 66, 80, 0.85);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        /* é«˜çº§æœç´¢æ¡† */
        .search-box {
            margin-bottom: 20px;
            position: relative;
        }

        #searchInput {
            width: 100%;
            padding: 16px 48px 16px 24px;
            background: rgba(95, 86, 109, 0.6);
            backdrop-filter: blur(6px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            color: #E0DCE5;
            border-radius: 35px;
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        #searchInput:focus {
            border-color: #8BC34A;
            box-shadow: 0 6px 24px rgba(139, 195, 74, 0.3);
            outline: none;
        }

        .search-box::after {
            content: "ğŸ”";
            position: absolute;
            right: 22px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.8;
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2));
        }

        /* å¡ç‰‡åˆ—è¡¨ */
        .proverb-list {
            height: calc(100% - 72px);
            overflow: hidden;
            position: relative;
        }

        .scroll-content {
            transition: transform 0.5s ease-out;
            will-change: transform;
        }

        /* åˆ—è¡¨é¡¹è®¾è®¡ */
        .proverb-item {
            padding: 18px;
            margin: 12px 0;
            background: linear-gradient(135deg,
                    rgba(109, 166, 93, 0.9),
                    rgba(109, 166, 93, 0.7));
            backdrop-filter: blur(6px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: #E0DCE5;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .proverb-item:hover {
            transform: translateX(12px) translateY(-4px);
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.25);
        }

        .proverb-item div:first-child {
            font-size: 15px;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .proverb-item div:last-child {
            font-size: 13px;
            color: rgba(224, 220, 229, 0.9);
        }

        /* è¯¦æƒ…é¢æ¿ */
        .proverb-detail-panel {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(74, 66, 80, 0.95);
            backdrop-filter: blur(16px);
            border-radius: 16px;
            padding: 24px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
            visibility: hidden;
        }

        .proverb-detail-panel.active {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .detail-content {
            background: rgba(95, 86, 109, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 24px;
            height: calc(100% - 48px);
            position: relative;
        }

        .detail-content h3 {
            color: #8BC34A;
            margin-bottom: 18px;
            font-size: 20px;
        }

        #proverb-desc {
            line-height: 1.8;
            font-size: 15px;
            color: rgba(224, 220, 229, 0.95);
        }

        .close-button {
            background: #ff5555;
            border: none;
            color: white;
            width: 34px;
            height: 34px;
            border-radius: 50%;
            cursor: pointer;
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-button:hover {
            transform: rotate(90deg) scale(1.1);
            background: #ff4444;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
            background: rgba(0, 0, 0, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(109, 166, 93, 0.7);
            border-radius: 6px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                padding: 16px;
            }

            #chart-container {
                height: 500px;
                min-height: auto;
            }

            .right-panel {
                width: 100%;
                height: 500px;
            }

            .main-nav {
                padding: 12px 16px;
                gap: 12px;
            }

            .nav-btn {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <nav class="main-nav">
        <button class="nav-btn" onclick="window.location.href='home.html'">é¦–é¡µ</button>
        <button class="nav-btn" onclick="window.location.href='category.html'">åˆ†ç±»ä½“ç³»</button>
        <button class="nav-btn" onclick="window.location.href='analysis.html'">æ•°æ®ç»Ÿè®¡</button>
        <button class="nav-btn" onclick="window.location.href='about.html'">å…³äºé¡¹ç›®</button>
    </nav>

    <div class="container">
        <div id="chart-container"></div>
        <div class="right-panel">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="è¾“å…¥å…³é”®è¯...">
            </div>
            <div class="proverb-list">
                <div class="scroll-content" id="scrollContent"></div>
            </div>
            <div id="proverb-detail-panel" class="proverb-detail-panel">
                <div class="detail-content">
                    <h3>è°šè¯­è¯¦ç»†è§£é‡Š</h3>
                    <p id="proverb-desc"></p>
                    <button id="close-detail" class="close-button">Ã—</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const DataManager = {
            items: [],
            async init() {
                const response = await fetch('./data/proverbs.json');
                const rawData = await response.json();
                const sanitize = (node) => {
                    const { parent, ...rest } = node;
                    if (rest.children) rest.children = rest.children.map(sanitize);
                    return rest;
                };
                const fullData = rawData.map(sanitize);
                this.processData(fullData);
                return fullData;
            },
            processData(fullData) {
                const queue = [...fullData];
                while (queue.length) {
                    const node = queue.shift();
                    if (node.children) {
                        queue.push(...node.children);
                    } else {
                        this.items.push({
                            text: node.name,
                            desc: node.desc || 'ä¼ ç»Ÿå†œäº‹ç»éªŒæ€»ç»“',
                            category: this.getCategoryPath(node)
                        });
                    }
                }
            },
            getCategoryPath(node) {
                const path = [];
                let current = node;
                while (current) {
                    path.unshift(current.name);
                    current = current.parent;
                }
                return path.slice(0, -1).join(' > ');
            },
            search(keyword) {
                const lowerKeyword = keyword.toLowerCase();
                return this.items.filter(item =>
                    item.text.toLowerCase().includes(lowerKeyword) ||
                    item.category.toLowerCase().includes(lowerKeyword))
            }
        };

        class AutoScroller {
            constructor(container) {
                this.container = container;
                this.content = container.querySelector('#scrollContent');
                this.position = 0;
                this.speed = 0.5;
                this.isScrolling = false;
                this.rafId = null;
                this.updateDimensions();
            }

            updateDimensions() {
                this.contentHeight = this.content.scrollHeight;
                this.containerHeight = this.container.clientHeight;
            }

            start() {
                if (this.isScrolling) return;
                this.isScrolling = true;
                this.scroll();
            }

            stop() {
                this.isScrolling = false;
                cancelAnimationFrame(this.rafId);
            }

            reset() {
                this.position = 0;
                this.content.style.transform = 'translateY(0)';
                this.updateDimensions();
            }

            scroll() {
                if (!this.isScrolling) return;
                this.updateDimensions();

                if (this.contentHeight > this.containerHeight) {
                    this.position -= this.speed;
                    if (-this.position >= this.contentHeight) {
                        this.position = this.containerHeight;
                    }
                    this.content.style.transform = `translateY(${this.position}px)`;
                    this.rafId = requestAnimationFrame(() => this.scroll());
                }
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const fullData = await DataManager.init();
            let currentItems = DataManager.items;
            let refreshInterval = null;
            let searchTimer = null;

            const chart = echarts.init(document.getElementById('chart-container'));
            chart.setOption({
                series: [{
                    type: 'sunburst',
                    data: fullData,
                    radius: [0, '95%'],
                    label: {
                        rotate: 'radial',
                        fontSize: 12,
                        formatter: p => p.name.length > 4 ? p.name.substr(0, 4) + '...' : p.name
                    },
                    levels: [
                        { itemStyle: { color: '#6DA65D' }, r0: '0%', r: '30%' },
                        { itemStyle: { color: '#4A4250' }, r0: '30%', r: '60%' },
                        { itemStyle: { color: '#5F566D' }, r0: '60%', r: '80%' }
                    ],
                    itemStyle: {
                        borderWidth: 2,
                        borderColor: '#2E2733'
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            });

            const scroller = new AutoScroller(document.querySelector('.proverb-list'));

            chart.on('click', (params) => {
                if (params.treePathInfo.length === 3) {
                    const searchText = params.name;
                    document.getElementById('searchInput').value = searchText;
                    clearInterval(refreshInterval);
                    currentItems = DataManager.search(searchText);
                    updateProverbList(currentItems);
                }
            });

            function updateProverbList(items) {
                const html = items.length ? items.map(item => `
                    <div class="proverb-item" 
                         data-text="${item.text}" 
                         data-desc="${item.desc}">
                        <div>${item.text}</div>
                        <div>${item.category}</div>
                    </div>
                `).join('') : '<div class="proverb-item">æ— åŒ¹é…ç»“æœ</div>';

                document.getElementById('scrollContent').innerHTML = html;
                scroller.reset();
                if (!document.getElementById('searchInput').value) scroller.start();
            }

            function startAutoRefresh() {
                refreshInterval = setInterval(() => {
                    const visibleCount = Math.max(15, Math.floor(scroller.containerHeight / 56));
                    const shuffled = [...DataManager.items].sort(() => Math.random() - 0.5);
                    currentItems = shuffled.slice(0, visibleCount);
                    updateProverbList(currentItems);
                }, 2000);
            }

            document.getElementById('searchInput').addEventListener('input', function (e) {
                clearTimeout(searchTimer);
                searchTimer = setTimeout(() => {
                    const keyword = e.target.value.trim();
                    clearInterval(refreshInterval);
                    currentItems = keyword ? DataManager.search(keyword) : DataManager.items;
                    if (!keyword) startAutoRefresh();
                    updateProverbList(currentItems);
                }, 300);
            });

            document.getElementById('scrollContent').addEventListener('click', (e) => {
                const item = e.target.closest('.proverb-item');
                if (item) {
                    document.getElementById('proverb-desc').textContent = item.dataset.desc;
                    document.getElementById('proverb-detail-panel').classList.add('active');
                    scroller.stop();
                    clearInterval(refreshInterval);
                }
            });

            document.getElementById('close-detail').addEventListener('click', () => {
                document.getElementById('proverb-detail-panel').classList.remove('active');
                if (!document.getElementById('searchInput').value) startAutoRefresh();
                scroller.start();
            });

            updateProverbList(currentItems);
            startAutoRefresh();
        });
    </script>
</body>

</html>