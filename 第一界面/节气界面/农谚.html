<!DOCTYPE html>
<html lang="zh-CN" style="height: 100%">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†œè°šåˆ†ç±»ç³»ç»Ÿ-å®Œæ•´ç‰ˆ</title>
    <script src="./js/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
    <style>
        /* èƒŒæ™¯æ ·å¼ */
        body {
            background: #e3e1e4f8 url('./img/èƒŒæ™¯å›¾ï¼ˆå†œè°šï¼‰.png') no-repeat center center fixed;
            background-size: cover;
            height: 100%;
            font-family: 'Consolas', monospace;
            padding-top: 64px;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(46, 39, 51, 0.65);
            z-index: -1;
        }

        /* ç»Ÿä¸€çš„å¯¼èˆªæ æ ·å¼ */
        .main-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: rgba(255, 255, 255, 0.15);
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 40px;
            backdrop-filter: blur(25px) saturate(1.8);
            border-bottom: 1px solid rgba(212, 180, 131, 0.6);
        }

        .nav-buttons {
            display: flex;
            gap: 25px;
            margin-left: auto;
        }

        .nav-button {
            padding: 12px 28px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.25);
            color: #4A4A4A;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(20px) saturate(1.5);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .nav-button:hover {
            background: rgba(255, 255, 255, 0.4);
            color: #4A4A4A;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(25px) saturate(1.8);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            display: flex;
            height: calc(100vh - 64px);
            padding: 20px;
            gap: 20px;
        }

        #chart-container {
            flex: 1;
            background: rgba(58, 50, 65, 0);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }

        /* å³ä¾§é¢æ¿ */
        .right-panel {
            width: 400px;
            background: rgba(58, 50, 65, 0.35);
            border-radius: 8px;
            padding: 15px;
            position: relative;
        }

        /* æœç´¢æ¡† */
        .search-box {
            margin-bottom: 15px;
            position: relative;
        }

        #searchInput {
            width: 100%;
            padding: 12px 40px 12px 20px;
            background: #5F566D;
            border: 2px solid #6DA65D;
            color: #E0DCE5;
            border-radius: 30px;
            font-family: 'Consolas', monospace;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        #searchInput::placeholder {
            color: #A89EB5;
            opacity: 0.8;
        }

        #searchInput:focus {
            border-color: #8BC34A;
            outline: none;
            box-shadow: 0 4px 12px rgba(139, 195, 74, 0.2);
        }

        .search-box::after {
            content: "ğŸ”";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.8;
            pointer-events: none;
            filter: grayscale(100%);
            transition: opacity 0.3s;
        }

        /* è°šè¯­åˆ—è¡¨ */
        .proverb-list {
            height: calc(100% - 60px);
            overflow: hidden;
            /* åˆå§‹çŠ¶æ€ä¸å…è®¸æ»šåŠ¨ */
            padding-right: 10px;
        }

        .proverb-list.scrollable {
            overflow-y: auto;
            /* å…è®¸æ»šåŠ¨æ—¶å¯ç”¨æ»šåŠ¨æ¡ */
        }

        .scroll-content {
            padding: 10px 0;
            transition: transform 0.5s ease;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .proverb-list::-webkit-scrollbar {
            width: 8px;
        }

        .proverb-list::-webkit-scrollbar-track {
            background: rgba(58, 50, 65, 0.3);
            border-radius: 4px;
        }

        .proverb-list::-webkit-scrollbar-thumb {
            background: #6DA65D;
            border-radius: 4px;
        }

        .proverb-list::-webkit-scrollbar-thumb:hover {
            background: #8BC34A;
        }

        .proverb-item {
            padding: 12px;
            margin: 8px 0;
            background: #6DA65D;
            border-radius: 6px;
            color: #E0DCE5;
            cursor: pointer;
            transition: transform 0.3s;
            min-height: 100px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .proverb-text {
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 5px;
            line-height: 1.3;
        }

        .proverb-desc {
            font-size: 12px;
            color: #E0DCE5;
            opacity: 0.9;
            line-height: 1.4;
            margin: 8px 0;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex-grow: 1;
        }

        .proverb-category {
            font-size: 11px;
            color: #A89EB5;
            margin-top: auto;
            padding-top: 4px;
            border-top: 1px dashed rgba(168, 158, 181, 0.3);
        }

        .proverb-item:hover {
            transform: translateX(10px);
            background: #7dbd6d;
        }

        /* è¯¦æƒ…é¢æ¿ */
        .proverb-detail-panel {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #4A4250;
            z-index: 100;
            padding: 20px;
            border-radius: 8px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .proverb-detail-panel.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        .detail-content {
            background: #5F566D;
            padding: 20px;
            border-radius: 8px;
            height: calc(100% - 40px);
            color: #E0DCE5;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .detail-text {
            flex: 0 0 auto;
            max-height: 40%;
            overflow-y: auto;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(109, 166, 93, 0.3);
        }

        .detail-wordcloud {
            flex: 1;
            min-height: 250px;
            background: rgba(58, 50, 65, 0.3);
            border-radius: 8px;
            border: 2px solid rgba(109, 166, 93, 0.3);
            margin: 0 10px;
        }

        .close-button {
            background: #ff5555;
            border: none;
            color: white;
            font-size: 20px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .close-button:hover {
            background: #ff4444;
        }
    </style>
</head>

<body>
    <nav class="main-nav">
        <div class="nav-buttons">
            <button class="nav-button" onclick="window.location.href='../1ç•Œé¢.html'">äºŒåå››èŠ‚æ°”</button>
        </div>
    </nav>

    <div class="container">
        <div id="chart-container"></div>
        <div class="right-panel">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="è¾“å…¥å†œè°šæˆ–æ ‡ç­¾...">
            </div>
            <div class="proverb-list">
                <div class="scroll-content" id="scrollContent"></div>
            </div>
            <div id="proverb-detail-panel" class="proverb-detail-panel">
                <div class="detail-content">
                    <div class="detail-text">
                        <h3>è°šè¯­è¯¦ç»†è§£é‡Š</h3>
                        <p id="proverb-desc"></p>
                    </div>
                    <div class="detail-wordcloud">
                        <div id="wordcloud-chart" style="width: 100%; height: 100%;"></div>
                    </div>
                    <button id="close-detail" class="close-button">Ã—</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const DataManager = {
            items: [],
            async init() {
                const response = await fetch('./data/proverbs.json');
                const rawData = await response.json();
                const sanitize = (node) => {
                    const { parent, ...rest } = node;
                    if (rest.children) rest.children = rest.children.map(sanitize);
                    return rest;
                };
                const fullData = rawData.map(sanitize);
                this.processData(fullData);
                return fullData;
            },
            processData(fullData) {
                const queue = [...fullData];
                while (queue.length) {
                    const node = queue.shift();
                    if (node.children) {
                        queue.push(...node.children);
                    } else {
                        this.items.push({
                            text: node.name,
                            desc: node.desc || 'ä¼ ç»Ÿå†œäº‹ç»éªŒæ€»ç»“',
                            category: this.getCategoryPath(node),
                            tags: node.tags || [] // æ–°å¢æ ‡ç­¾å­—æ®µ
                        });
                    }
                }
            },
            getCategoryPath(node) {
                const path = [];
                let current = node;
                while (current) {
                    path.unshift(current.name);
                    current = current.parent;
                }
                return path.slice(0, -1).join(' > ');
            },
            search(keyword) {
                const lowerKeyword = keyword.toLowerCase();
                return this.items.filter(item =>
                    item.text.toLowerCase().includes(lowerKeyword) ||
                    item.category.toLowerCase().includes(lowerKeyword) ||
                    item.tags.some(tag => tag.toLowerCase().includes(lowerKeyword)) // æ ‡ç­¾æœç´¢
                );
            },
            generateWordCloudData(item) {
                const words = [];
                const addWord = (text, value) => {
                    if (text && text.length > 0) {
                        words.push({ name: text, value: value });
                    }
                };

                // ä»tagsä¸­æ·»åŠ å…³é”®è¯ï¼ˆé«˜æƒé‡ï¼‰
                if (item.tags) {
                    item.tags.forEach(tag => addWord(tag, Math.random() * 20 + 180));
                }

                // ä»è°šè¯­æ–‡æœ¬ä¸­æå–å…³é”®è¯
                const proverbKeywords = this.extractKeywords(item.text);
                proverbKeywords.forEach(keyword => addWord(keyword, Math.random() * 15 + 165));

                // ä»æè¿°ä¸­æå–å…³é”®è¯
                const descKeywords = this.extractKeywords(item.desc);
                descKeywords.forEach(keyword => addWord(keyword, Math.random() * 15 + 150));

                // æ·»åŠ æ›´å¤šç›¸å…³è¯æ±‡
                const relatedWords = this.getRelatedWords(item);
                relatedWords.forEach(word => addWord(word, Math.random() * 10 + 140));

                // æ·»åŠ åŸºç¡€å†œä¸šè¯æ±‡
                const baseWords = ['å†œä¸š', 'ç§æ¤', 'æ”¶è·', 'å­£èŠ‚', 'æ°”å€™', 'åœŸå£¤', 'æ°´åˆ†', 'é˜³å…‰', 'æ¸©åº¦', 'æ¹¿åº¦', 'æ’­ç§', 'æ–½è‚¥', 'é™¤è‰', 'çŒæº‰', 'æ”¶å‰²'];
                baseWords.forEach(word => addWord(word, Math.random() * 10 + 30));

                return words.slice(0, 45); // æ¢å¤åˆ°45ä¸ªè¯
            },
            extractKeywords(text) {
                if (!text) return [];

                // å®šä¹‰å…³é”®è¯æ¨¡å¼
                const patterns = [
                    /([æ­£äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]+æœˆ)/g,
                    /(æ˜¥å¤ç§‹å†¬)/g,
                    /(ç«‹æ˜¥|é›¨æ°´|æƒŠè›°|æ˜¥åˆ†|æ¸…æ˜|è°·é›¨|ç«‹å¤|å°æ»¡|èŠ’ç§|å¤è‡³|å°æš‘|å¤§æš‘|ç«‹ç§‹|å¤„æš‘|ç™½éœ²|ç§‹åˆ†|å¯’éœ²|éœœé™|ç«‹å†¬|å°é›ª|å¤§é›ª|å†¬è‡³|å°å¯’|å¤§å¯’)/g,
                    /(å°éº¦|æ°´ç¨»|ç‰ç±³|æ£‰èŠ±|å¤§è±†|é«˜ç²±|è°·å­|çº¢è–¯|èŠ±ç”Ÿ)/g,
                    /(æ’­ç§|æ”¶å‰²|æ–½è‚¥|çŒæº‰|é™¤è‰|è€•ä½œ)/g,
                    /(å¹²æ—±|æ´ªæ¶|éœœå†»|å†°é›¹|å¤§é£|é›·æš´)/g,
                    /(æ¸©åº¦|æ¹¿åº¦|é™é›¨|é™é›ª|é£å‘)/g,
                    /(ä¸°æ”¶|å‡äº§|æ­‰æ”¶|å¢äº§)/g
                ];

                const keywords = [];
                patterns.forEach(pattern => {
                    const matches = text.match(pattern);
                    if (matches) {
                        keywords.push(...matches);
                    }
                });

                // æ·»åŠ ä¸€äº›é€šç”¨å†œä¸šè¯æ±‡
                const commonWords = ['å†œäº‹', 'èŠ‚æ°”', 'å¤©æ°”', 'ä½œç‰©', 'ç”°é—´', 'ç®¡ç†', 'é¢„æµ‹', 'ç»éªŒ'];
                commonWords.forEach(word => {
                    if (text.includes(word)) {
                        keywords.push(word);
                    }
                });

                return [...new Set(keywords)]; // å»é‡
            },
            getRelatedWords(item) {
                const relatedWords = [];

                // æ ¹æ®ä¸åŒç±»å‹çš„è°šè¯­æ·»åŠ ç›¸å…³è¯æ±‡
                const text = item.text + ' ' + item.desc;

                // æ—¶é—´ç›¸å…³
                if (text.includes('æ˜¥') || text.includes('æ­£æœˆ') || text.includes('äºŒæœˆ') || text.includes('ä¸‰æœˆ')) {
                    relatedWords.push('æ˜¥è€•', 'æ’­ç§', 'å‘èŠ½', 'å›æš–', 'è§£å†»', 'æ˜¥é›¨', 'å«©èŠ½', 'ä¸‡ç‰©å¤è‹');
                }
                if (text.includes('å¤') || text.includes('å››æœˆ') || text.includes('äº”æœˆ') || text.includes('å…­æœˆ')) {
                    relatedWords.push('å¤ç§', 'ç”Ÿé•¿', 'å¼€èŠ±', 'é«˜æ¸©', 'é›·é›¨', 'çŒæº‰', 'é™¤è‰', 'èŒ‚ç››');
                }
                if (text.includes('ç§‹') || text.includes('ä¸ƒæœˆ') || text.includes('å…«æœˆ') || text.includes('ä¹æœˆ')) {
                    relatedWords.push('ç§‹æ”¶', 'æˆç†Ÿ', 'ä¸°æ”¶', 'å‡‰çˆ½', 'éœœé™', 'å‚¨è—', 'é‡‘é»„', 'ç¡•æœ');
                }
                if (text.includes('å†¬') || text.includes('åæœˆ') || text.includes('åä¸€æœˆ') || text.includes('åäºŒæœˆ')) {
                    relatedWords.push('å†¬è—', 'ä¼‘çœ ', 'ä¸¥å¯’', 'é›ªèŠ±', 'å†°å†»', 'ä¿æš–', 'å‚¨å¤‡', 'é™å¾…');
                }

                // å¤©æ°”ç›¸å…³
                if (text.includes('é›¨') || text.includes('æ°´')) {
                    relatedWords.push('æ»‹æ¶¦', 'æ¹¿æ¶¦', 'æ°´åˆ†', 'çŒæº‰', 'æ¶ç¾', 'æ’æ°´', 'è“„æ°´');
                }
                if (text.includes('æ™´') || text.includes('é˜³')) {
                    relatedWords.push('é˜³å…‰', 'å…‰ç…§', 'æ¸©æš–', 'å¹²ç‡¥', 'æ™¾æ™’', 'å…‰åˆä½œç”¨');
                }
                if (text.includes('é£')) {
                    relatedWords.push('é€šé£', 'ä¼ ç²‰', 'å¹²ç‡¥', 'é™æ¸©', 'å€’ä¼', 'é£å‘');
                }
                if (text.includes('é›ª') || text.includes('éœœ') || text.includes('å†°')) {
                    relatedWords.push('å†»å®³', 'ä¿æ¸©', 'è¦†ç›–', 'èåŒ–', 'ä½æ¸©', 'é˜²å¯’');
                }

                // ä½œç‰©ç›¸å…³
                if (text.includes('éº¦') || text.includes('è°·') || text.includes('ç¨»')) {
                    relatedWords.push('ç²®é£Ÿ', 'ä¸»é£Ÿ', 'æ”¶æˆ', 'ç£¨é¢', 'ç¨»ç”°', 'éº¦ç”°', 'è°·ä»“');
                }
                if (text.includes('æ£‰')) {
                    relatedWords.push('çº¤ç»´', 'çººç»‡', 'æ£‰æ¡ƒ', 'é‡‡æ‘˜', 'ç»æµä½œç‰©');
                }
                if (text.includes('èœ') || text.includes('ç“œ')) {
                    relatedWords.push('è”¬èœ', 'è¥å…»', 'æ–°é²œ', 'èœå›­', 'ç“œæœ', 'ç»´ç”Ÿç´ ');
                }

                // å†œäº‹ç›¸å…³
                if (text.includes('ç§') || text.includes('æ’­')) {
                    relatedWords.push('ç§å­', 'è‚²è‹—', 'å‘èŠ½', 'ç”Ÿæ ¹', 'å‡ºè‹—', 'å†œæ—¶');
                }
                if (text.includes('æ”¶') || text.includes('å‰²')) {
                    relatedWords.push('æ”¶è·', 'ä¸°æ”¶', 'å‚¨å­˜', 'æ™¾æ™’', 'è„±ç²’', 'å…¥ä»“');
                }
                if (text.includes('è‚¥') || text.includes('ç²ª')) {
                    relatedWords.push('è¥å…»', 'åœŸå£¤', 'æœ‰æœºè‚¥', 'å¢äº§', 'åœ°åŠ›', 'æ–½è‚¥');
                }

                // é€šç”¨å†œä¸šè¯æ±‡
                relatedWords.push('å†œæ°‘', 'ç”°åœ°', 'åº„ç¨¼', 'æ”¶æˆ', 'ç»éªŒ', 'æ™ºæ…§', 'ä¼ ç»Ÿ', 'è‡ªç„¶');

                return [...new Set(relatedWords)]; // å»é‡
            }
        };

        class AutoScroller {
            constructor(container) {
                this.container = container;
                this.content = container.querySelector('#scrollContent');
                this.position = 0;
                this.speed = 0.5;
                this.isScrolling = false;
                this.rafId = null;
                this.updateDimensions();
            }

            updateDimensions() {
                this.contentHeight = this.content.scrollHeight;
                this.containerHeight = this.container.clientHeight;
            }

            start() {
                if (this.isScrolling) return;
                this.isScrolling = true;
                this.scroll();
            }

            stop() {
                this.isScrolling = false;
                cancelAnimationFrame(this.rafId);
            }

            reset() {
                this.position = 0;
                this.content.style.transform = 'translateY(0)';
                this.updateDimensions();
            }

            scroll() {
                if (!this.isScrolling) return;
                this.updateDimensions();

                if (this.contentHeight > this.containerHeight) {
                    this.position -= this.speed;
                    if (-this.position >= this.contentHeight) {
                        this.position = this.containerHeight;
                    }
                    this.content.style.transform = `translateY(${this.position}px)`;
                    this.rafId = requestAnimationFrame(() => this.scroll());
                }
            }
        }

        function initChart(data) {
            const chart = echarts.init(document.getElementById('chart-container'));
            chart.setOption({
                series: [{
                    type: 'sunburst',
                    data: data,
                    radius: [0, '90%'],
                    label: {
                        rotate: 'radial',
                        fontSize: 10,
                        color: '#E0DCE5',
                        show: function(params) {
                            // åªæœ‰åœ¨æ‚¬åœæ—¶æ‰æ˜¾ç¤ºç¬¬ä¸‰å±‚ï¼ˆè°šè¯­ï¼‰çš„æ ‡ç­¾
                            return params.treePathInfo.length < 3;
                        },
                        formatter: function (params) {
                            // æ ¹æ®å±‚çº§è®¾ç½®ä¸åŒçš„æ˜¾ç¤ºæ–¹å¼
                            if (params.treePathInfo.length === 1) {
                                // ç¬¬ä¸€å±‚ï¼ˆå­£èŠ‚ï¼‰ï¼šæ˜¾ç¤ºå®Œæ•´åç§°
                                return params.name;
                            } else if (params.treePathInfo.length === 2) {
                                // ç¬¬äºŒå±‚ï¼ˆæœˆä»½ï¼‰ï¼šæ˜¾ç¤ºå®Œæ•´åç§°
                                return params.name;
                            } else {
                                // ç¬¬ä¸‰å±‚ï¼ˆè°šè¯­ï¼‰ï¼šåªæ˜¾ç¤ºç¬¬ä¸€ä¸ªå­—
                                return params.name.charAt(0);
                            }
                        },
                        position: 'outside',
                        align: 'center',
                        verticalAlign: 'middle',
                        padding: [0, 3],
                        backgroundColor: 'rgba(58, 50, 65, 0.7)',
                        borderRadius: 4
                    },
                    levels: [
                        {
                            itemStyle: {
                                color: '#6DA65D',
                                borderWidth: 2,
                                borderColor: '#2E2733'
                            },
                            r0: '0%',
                            r: '25%',
                            label: {
                                fontSize: 14,
                                fontWeight: 'bold'
                            }
                        },
                        {
                            itemStyle: {
                                color: '#4A4250',
                                borderWidth: 2,
                                borderColor: '#2E2733'
                            },
                            r0: '25%',
                            r: '55%',
                            label: {
                                fontSize: 12
                            }
                        },
                        {
                            itemStyle: {
                                color: '#5F566D',
                                borderWidth: 2,
                                borderColor: '#2E2733'
                            },
                            r0: '55%',
                            r: '90%',
                            label: {
                                fontSize: 10
                            }
                        }
                    ],
                    itemStyle: {
                        borderWidth: 2,
                        borderColor: '#2E2733'
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        },
                        label: {
                            show: true,
                            fontSize: 14,
                            backgroundColor: 'rgba(58, 50, 65, 0.9)',
                            formatter: function (params) {
                                // æ‚¬åœæ—¶æ˜¾ç¤ºå†œè°šé¦–å­—
                                if (params.treePathInfo.length === 3) {
                                    return params.name.charAt(0);
                                } else if (params.treePathInfo.length === 2) {
                                    return params.name;
                                } else {
                                    return params.name;
                                }
                            }
                        }
                    },
                    highlightPolicy: 'ancestor',
                    downplay: {
                        label: {
                            opacity: 0.5
                        }
                    },
                    nodeClick: 'rootToNode',
                    sort: function (a, b) {
                        return b.value - a.value;
                    }
                }],
                tooltip: {
                    trigger: 'item',
                    formatter: function (params) {
                        if (params.treePathInfo.length === 3) {
                            return `${params.name}<br/>${params.data.desc || 'æš‚æ— è¯¦ç»†è§£é‡Š'}`;
                        }
                        return params.name;
                    }
                }
            });
            return chart;
        }

        function initWordCloud(data) {
            const wordcloudChart = echarts.init(document.getElementById('wordcloud-chart'));
            wordcloudChart.setOption({
                backgroundColor: 'transparent',
                tooltip: {
                    show: true,
                    formatter: function(params) {
                        return params.name;
                    },
                    backgroundColor: 'rgba(58, 50, 65, 0.9)',
                    borderColor: '#6DA65D',
                    textStyle: {
                        color: '#E0DCE5'
                    }
                },
                series: [{
                    type: 'wordCloud',
                    gridSize: 10,
                    sizeRange: [20, 60],
                    rotationRange: [-30, 30],
                    rotationStep: 40,
                    shape: 'circle',
                    width: '98%',
                    height: '98%',
                    left: 'center',
                    top: 'center',
                    drawOutOfBound: false,
                    textStyle: {
                        fontFamily: 'Microsoft YaHei, SimHei, sans-serif',
                        fontWeight: function(params) {
                            return params.value > 40 ? 'bold' : 'normal';
                        },
                        color: function() {
                            const colors = ['#6DA65D', '#8BC34A', '#4A90E2', '#E8C547', '#C44D58', '#9C27B0', '#FF9800'];
                            return colors[Math.floor(Math.random() * colors.length)];
                        }
                    },
                    emphasis: {
                        textStyle: {
                            shadowBlur: 8,
                            shadowColor: 'rgba(109, 166, 93, 0.8)',
                            color: '#8BC34A'
                        }
                    },
                    data: data
                }]
            });
            return wordcloudChart;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const fullData = await DataManager.init();
            let currentItems = DataManager.items;
            let refreshInterval = null;
            let searchTimer = null;
            let isAutoScrolling = true;
            let scrollPosition = 0;

            const chart = initChart(fullData);
            const proverbList = document.querySelector('.proverb-list');
            const scrollContent = document.getElementById('scrollContent');

            // è‡ªåŠ¨æ»šåŠ¨å‡½æ•°
            function autoScroll() {
                if (!isAutoScrolling) return;

                const containerHeight = proverbList.clientHeight;
                const contentHeight = scrollContent.scrollHeight;

                if (contentHeight > containerHeight) {
                    scrollPosition -= 1;
                    if (-scrollPosition >= contentHeight) {
                        scrollPosition = containerHeight;
                    }
                    scrollContent.style.transform = `translateY(${scrollPosition}px)`;
                    requestAnimationFrame(autoScroll);
                }
            }

            // æ›´æ–°è°šè¯­åˆ—è¡¨æ˜¾ç¤º
            function updateProverbList(items, enableAutoScroll = false) {
                const html = items.length ? items.map(item => `
                    <div class="proverb-item" 
                         data-text="${item.text}" 
                         data-desc="${item.desc}">
                        <div class="proverb-text">${item.text}</div>
                        <div class="proverb-desc">${item.desc}</div>
                        <div class="proverb-category">${item.category}</div>
                    </div>
                `).join('') : '<div class="proverb-item">æ— åŒ¹é…ç»“æœ</div>';

                scrollContent.innerHTML = html;
                scrollPosition = 0;
                scrollContent.style.transform = 'translateY(0)';

                if (enableAutoScroll) {
                    isAutoScrolling = true;
                    proverbList.classList.remove('scrollable');
                    autoScroll();
                } else {
                    isAutoScrolling = false;
                    proverbList.classList.add('scrollable');
                }
            }

            // ç‚¹å‡»äº‹ä»¶å¤„ç†
            chart.on('click', (params) => {
                if (params.treePathInfo) {
                    const searchText = params.name;
                    document.getElementById('searchInput').value = searchText;

                    currentItems = DataManager.search(searchText);

                    // å¦‚æœç‚¹å‡»çš„æ˜¯æœ€åº•å±‚çš„èŠ‚ç‚¹ï¼ˆå†œè°šæœ¬èº«ï¼‰
                    if (params.treePathInfo.length === 3) {
                        const proverbItem = currentItems[0];
                        if (proverbItem) {
                            // ç›´æ¥æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
                            document.querySelector('.search-box').style.display = 'none';
                            document.querySelector('.proverb-list').style.display = 'none';
                            document.getElementById('proverb-detail-panel').classList.add('active');
                            document.getElementById('proverb-desc').textContent = proverbItem.desc || 'æš‚æ— è¯¦ç»†è§£é‡Š';

                            // ç”Ÿæˆå¹¶æ˜¾ç¤ºè¯äº‘
                            const wordCloudData = DataManager.generateWordCloudData(proverbItem);
                            setTimeout(() => {
                                initWordCloud(wordCloudData);
                            }, 100);

                            isAutoScrolling = false;
                        }
                    } else {
                        // å¦‚æœä¸æ˜¯æœ€åº•å±‚èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºè¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰è°šè¯­
                        document.querySelector('.search-box').style.display = 'block';
                        document.querySelector('.proverb-list').style.display = 'block';
                        document.getElementById('proverb-detail-panel').classList.remove('active');
                        updateProverbList(currentItems, false); // ä¸è‡ªåŠ¨æ»šåŠ¨ï¼Œå…è®¸æ‰‹åŠ¨æ»šåŠ¨
                    }
                }
            });

            // ç‚¹å‡»å†œè°šæ¡æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
            document.getElementById('scrollContent').addEventListener('click', (e) => {
                const item = e.target.closest('.proverb-item');
                if (item) {
                    document.querySelector('.search-box').style.display = 'none';
                    document.querySelector('.proverb-list').style.display = 'none';
                    document.getElementById('proverb-detail-panel').classList.add('active');
                    document.getElementById('proverb-desc').textContent = item.dataset.desc || 'æš‚æ— è¯¦ç»†è§£é‡Š';

                    // æ‰¾åˆ°å¯¹åº”çš„è°šè¯­æ•°æ®å¹¶ç”Ÿæˆè¯äº‘
                    const proverbText = item.dataset.text;
                    const proverbItem = DataManager.items.find(p => p.text === proverbText);
                    if (proverbItem) {
                        const wordCloudData = DataManager.generateWordCloudData(proverbItem);
                        setTimeout(() => {
                            initWordCloud(wordCloudData);
                        }, 100);
                    }

                    isAutoScrolling = false;
                }
            });

            // æœç´¢æ¡†è¾“å…¥äº‹ä»¶
            document.getElementById('searchInput').addEventListener('input', function (e) {
                clearTimeout(searchTimer);
                searchTimer = setTimeout(() => {
                    const keyword = e.target.value.trim();

                    if (keyword) {
                        currentItems = DataManager.search(keyword);
                        updateProverbList(currentItems, false); // æœç´¢æ—¶ä¸è‡ªåŠ¨æ»šåŠ¨
                    } else {
                        currentItems = DataManager.items;
                        updateProverbList(currentItems, true); // æ¸…ç©ºæœç´¢æ—¶æ¢å¤è‡ªåŠ¨æ»šåŠ¨
                    }
                }, 300);
            });

            // å…³é—­è¯¦æƒ…é¢æ¿æ—¶æ¢å¤è‡ªåŠ¨æ»šåŠ¨
            document.getElementById('close-detail').addEventListener('click', () => {
                document.getElementById('proverb-detail-panel').classList.remove('active');
                document.querySelector('.search-box').style.display = 'block';
                document.querySelector('.proverb-list').style.display = 'block';

                if (!document.getElementById('searchInput').value) {
                    updateProverbList(currentItems, true);
                }
            });

            // åˆå§‹çŠ¶æ€ï¼šæ˜¾ç¤ºéšæœºè°šè¯­å¹¶è‡ªåŠ¨æ»šåŠ¨
            updateProverbList(currentItems, true);
        });
    </script>
</body>

</html>